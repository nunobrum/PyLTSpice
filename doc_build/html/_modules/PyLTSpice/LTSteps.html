
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PyLTSpice.LTSteps &#8212; PyLTSpice 2.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for PyLTSpice.LTSteps</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding=utf-8</span>

<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Name:        LTSteps.py</span>
<span class="c1"># Purpose:     Process LTSpice output files and align data for usage in a spread-</span>
<span class="c1">#              sheet tool such as Excel, or Calc.</span>
<span class="c1">#</span>
<span class="c1"># Author:      Nuno Brum (nuno.brum@gmail.com)</span>
<span class="c1">#</span>
<span class="c1"># Created:     19-05-2014</span>
<span class="c1"># Licence:     refer to the LICENSE file</span>
<span class="c1"># -------------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module allows to process data generated by LTSpice during simulation. There are three types of files that are</span>
<span class="sd">handled by this module.</span>

<span class="sd">    + log files - Files with the extension &#39;.log&#39; that are automatically generated during simulation, and that are</span>
<span class="sd">      normally accessible with the shortcut Ctrl+L after a simulation is ran.Log files are interesting for two reasons.</span>

<span class="sd">            1. If .STEP primitives are used, the log file contain the correspondence between the step run and the step</span>
<span class="sd">            value configuration.</span>

<span class="sd">            2. If .MEAS primitives are used in the schematic, the log file contains the measurements made on the output</span>
<span class="sd">            data.</span>

<span class="sd">      LTSteps.py can be used to retrieve both step and measurement information from log files.</span>

<span class="sd">    + txt files - Files exported from the Plot File -&gt; Export data as text menu. This file is an text file where data is</span>
<span class="sd">      saved in the text format. The reason to use PyLTSpice instead of another popular lib as pandas, is because the data</span>
<span class="sd">      format when .STEPS are used in the simulation is not not very practical. The PyLTSpice LTSteps.py can be used to</span>
<span class="sd">      reformat the text, so that the run parameter is added to the data as an additional column instead of a table</span>
<span class="sd">      divider. Please Check LTSpiceExport class for more information.</span>

<span class="sd">    + mout files - Files generated by the Plot File -&gt; Execute .MEAS Script menu. This command allows the user to run</span>
<span class="sd">      predefined .MEAS commands which create a .mout file. A .mout file has the measurement information stored in the</span>
<span class="sd">      following format:</span>

<span class="sd">      .. code-block:: text</span>

<span class="sd">            Measurement: Vout_rms</span>
<span class="sd">            step	RMS(V(OUT))	FROM	TO</span>
<span class="sd">             1	1.41109	0	0.001</span>
<span class="sd">             2	1.40729	0	0.001</span>

<span class="sd">            Measurement: Vin_rms</span>
<span class="sd">              step	RMS(V(IN))	FROM	TO</span>
<span class="sd">                 1	0.706221	0	0.001</span>
<span class="sd">                 2	0.704738	0	0.001</span>

<span class="sd">            Measurement: gain</span>
<span class="sd">              step	Vout_rms/Vin_rms</span>
<span class="sd">                 1	1.99809</span>
<span class="sd">                 2	1.99689</span>


<span class="sd">The LTSteps.py can be used directly from a command line by invoking python with the -m option as exemplified below.</span>

<span class="sd">.. code-block:: text</span>

<span class="sd">    $ python -m PyLTSpice.LTSteps &lt;path_to_filename&gt;</span>

<span class="sd">If `&lt;path_to_filename&gt;` is a log file, it will create a file with the same name, but with extension .tout that is a</span>
<span class="sd">tab separated value (tsv) file, which contains the .STEP and .MEAS information collected.</span>

<span class="sd">If `&lt;path_to_filename&gt;` is a txt exported file, it will create a file with the same name, but with extension .tsv a</span>
<span class="sd">tab separated value (tsv) file, which contains data reformatted with the step number as one of the columns. Please</span>
<span class="sd">consult the reformat_LTSpice_export() function for more information.</span>

<span class="sd">If `&lt;path_to_filename&gt;` is a mout file, it will create a file with the same name, but with extension .tmout that is a</span>
<span class="sd">tab separated value (tsv) file, which contains the .MEAS information collected, but adding the STEP run information</span>
<span class="sd">as one of the columns.</span>

<span class="sd">If `&lt;path_to_filename&gt;` argument is ommited, the script will automatically search for the newest .log/.txt/.mout file</span>
<span class="sd">and use it.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Nuno Canto Brum &lt;me@nunobrum.com&gt;&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2017, Fribourg Switzerland&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="o">*</span><span class="n">strs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">strs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
<div class="viewcode-block" id="message"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.message">[docs]</a>    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="o">*</span><span class="n">strs</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="enc_norm"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.enc_norm">[docs]</a><span class="k">def</span> <span class="nf">enc_norm</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">:</span>  <span class="c1"># This is to decode the LTSpice XVII encoding (unable to find the exact code)</span>
        <span class="k">return</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Removes zeros from the encoding</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">line</span>  <span class="c1"># Return as is</span></div>


<div class="viewcode-block" id="LTComplex"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTComplex">[docs]</a><span class="k">class</span> <span class="nc">LTComplex</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to represent complex numbers as exported by LTSpice</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">complex_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\((?P&lt;mag&gt;.*)dB,(?P&lt;ph&gt;.*)°\)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strvalue</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">complex_match</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">strvalue</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mag</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ph</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ph&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid complex value format&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="LTComplex.to_complex"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTComplex.to_complex">[docs]</a>    <span class="k">def</span> <span class="nf">to_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ph</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mag</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">mag</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mag</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ph</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="try_convert_value"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.try_convert_value">[docs]</a><span class="k">def</span> <span class="nf">try_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tries to convert the string into an integer and if it fails, tries to convert to a float, if it fails, then returns the</span>
<span class="sd">    value as string.</span>

<span class="sd">    :param value: value to convert</span>
<span class="sd">    :type value: str</span>
<span class="sd">    :return: converted value, if applicable</span>
<span class="sd">    :rtype: int, float, str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="n">LTComplex</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">ans</span></div>


<div class="viewcode-block" id="try_convert_values"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.try_convert_values">[docs]</a><span class="k">def</span> <span class="nf">try_convert_values</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Same as try_convert_values but applicable to an iterable</span>

<span class="sd">    :param values: Iterable that returns strings</span>
<span class="sd">    :type values:</span>
<span class="sd">    :return: list with the values converted to either integer (int) or floating point (float)</span>
<span class="sd">    :rtype: List[str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">answer</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">try_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">answer</span></div>


<div class="viewcode-block" id="reformat_LTSpice_export"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.reformat_LTSpice_export">[docs]</a><span class="k">def</span> <span class="nf">reformat_LTSpice_export</span><span class="p">(</span><span class="n">export_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tabular_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads an LTSpice File Export file and writes it back in a format that is more convenient for data treatment.</span>

<span class="sd">    When using the &quot;Export data as text&quot; in the raw file menu the data is already exported in a tabular format.</span>
<span class="sd">    However, if steps are being used, the step information doesn&#39;t appear on the table.  Instead the successive STEP</span>
<span class="sd">    runs are stacked on one after another, separated by the following text:</span>

<span class="sd">    .. code-block:: text</span>

<span class="sd">        Step Information: Ton=400m  (Run: 2/2)</span>

<span class="sd">    What would be desirable would be that the step number (Run number) and the STEP variable would be placed within the</span>
<span class="sd">    columns.  This allows, for example, using Excel functionality known as Pivot Tables to filter out data, or some other</span>
<span class="sd">    database selection function.</span>
<span class="sd">    The tab is chosen as separator because it is normally compatible with pasting data into Excel.</span>

<span class="sd">    :param export_file: Filename of the .txt file generated by the &quot;Export Data as Text&quot;</span>
<span class="sd">    :type export_file: str</span>
<span class="sd">    :param tabular_file: Filename of the tab separated values (TSV) file that</span>
<span class="sd">    :type tabular_file: str</span>
<span class="sd">    :return: Nothing</span>
<span class="sd">    :rtype: None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">export_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tabular_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="n">enc_norm</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
    <span class="c1"># writing header</span>
    <span class="n">go_header</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">run_no</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Just to avoid warning, this is later overridden by the step information</span>
    <span class="n">param_values</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Just to avoid warning, this is later overridden by the step information</span>
    <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Step Information: ([\w=\d\. -]+) +\(Run: (\d*)/\d*\)\n&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">enc_norm</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Step Information:&quot;</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="c1"># message(line, end=&quot;&quot;)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="c1"># message(match.groups())</span>
                <span class="n">step</span><span class="p">,</span> <span class="n">run_no</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                <span class="c1"># message(step, line, end=&quot;&quot;)</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">param_values</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">go_header</span><span class="p">:</span>
                    <span class="n">header_keys</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                        <span class="n">header_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">param_header</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_keys</span><span class="p">)</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Run</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">param_header</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
                    <span class="n">message</span><span class="p">(</span><span class="s2">&quot;Run</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">param_header</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
                    <span class="n">go_header</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="c1"># message(&quot;%s\t%s&quot;% (run_no, param_values))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run_no</span><span class="p">,</span> <span class="n">param_values</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>

    <span class="n">fin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="LTSpiceExport"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceExport">[docs]</a><span class="k">class</span> <span class="nc">LTSpiceExport</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Opens and reads LTSpice export data when using the &quot;Export data as text&quot; in the File Menu on the waveform window.</span>

<span class="sd">    The data is then accessible by using the following attributes implemented in this class.</span>

<span class="sd">    :property headers: list containing the headers on the exported data</span>
<span class="sd">    :property dataset: dictionary in which the keys are the the headers and the export file and the values are</span>
<span class="sd">        lists. When reading STEPed data, a new key called &#39;runno&#39; is added to the dataset.</span>

<span class="sd">    **Examples**</span>

<span class="sd">    ::</span>

<span class="sd">        export_data = LTSpiceExport(&quot;export_data_file.txt&quot;)</span>
<span class="sd">        for value in export_data.dataset[&#39;I(V1)&#39;]:</span>
<span class="sd">            print(f&quot;Do something with this value {value}&quot;)</span>

<span class="sd">    :param export_filename: path to the Export file.</span>
<span class="sd">    :type export_filename: str</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">export_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">file_header</span> <span class="o">=</span> <span class="n">enc_norm</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">file_header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># Set to read header</span>
        <span class="n">go_header</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">curr_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Step Information: ([\w=\d\. -]+) +\(Run: (\d*)/\d*\)\n&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">enc_norm</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Step Information:&quot;</span><span class="p">):</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="c1"># message(line, end=&quot;&quot;)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="c1"># message(match.groups())</span>
                    <span class="n">step</span><span class="p">,</span> <span class="n">run_no</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                    <span class="c1"># message(step, line, end=&quot;&quot;)</span>
                    <span class="n">curr_dic</span><span class="p">[</span><span class="s1">&#39;runno&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run_no</span>
                    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                        <span class="n">curr_dic</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">try_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">go_header</span><span class="p">:</span>
                        <span class="n">go_header</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># This is executed only once</span>
                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Initializes an empty list</span>

                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">curr_dic</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Initializes an empty list</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">curr_dic</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_dic</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">try_convert_value</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="n">fin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="LTSpiceLogReader"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceLogReader">[docs]</a><span class="k">class</span> <span class="nc">LTSpiceLogReader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads an LTSpice log file and retrieves the step information if it exists. The step information is then accessible</span>
<span class="sd">    by using the &#39;stepset&#39; property of this class.</span>
<span class="sd">    This class is intended to be used together with the LTSpice_RawRead to retrieve the runs that are associated with a</span>
<span class="sd">    given parameter setting.</span>

<span class="sd">    This class constructor only reads the step information of the log file. If the measures are needed, then the user</span>
<span class="sd">    should call the get_measures() method.</span>

<span class="sd">    :property stepset: dictionary in which the keys are the variables that were STEP&#39;ed during the simulation and</span>
<span class="sd">        the associated value is a list representing the sequence of assigned values during simulation.</span>

<span class="sd">    :property headers: list containing the headers on the exported data. This is only populated when the *read_measures*</span>
<span class="sd">        optional parameter is set to False.</span>

<span class="sd">    :property dataset: dictionary in which the keys are the the headers and the export file and the values are</span>
<span class="sd">         lists. This is information is only populated when the *read_measures* optional parameter is set to False.</span>

<span class="sd">    :param log_filename: path to the Export file.</span>
<span class="sd">    :type log_filename: str</span>
<span class="sd">    :param read_measures: Optional parameter to skip measuring data reading.</span>
<span class="sd">    :type read_measures: boolean</span>
<span class="sd">    :param step_set: Optional parameter to provide the steps from another file. This is used to process .mout files.</span>
<span class="sd">    :type step_set: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">read_measures</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">step_set</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logname</span> <span class="o">=</span> <span class="n">log_filename</span>
        <span class="n">fin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">step_set</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepset</span> <span class="o">=</span> <span class="n">step_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>  <span class="c1"># Dictionary in which the order of the keys is kept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Preparing a stepless measurement read regular expression</span>
        <span class="n">regx</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;^(?P&lt;name&gt;\w+):\s+.*=(?P&lt;value&gt;[\d\.E+\-\(\)dB,°]+)(( FROM (?P&lt;from&gt;[\d\.E+-]*) TO (?P&lt;to&gt;[\d\.E+-]*))|( at (?P&lt;at&gt;[\d\.E+-]*)))?&quot;</span><span class="p">,</span>
                <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

        <span class="n">message</span><span class="p">(</span><span class="s2">&quot;Processing LOG file&quot;</span><span class="p">,</span> <span class="n">log_filename</span><span class="p">)</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">enc_norm</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>

        <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.step&quot;</span><span class="p">):</span>
                <span class="c1"># message(line)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">=</span> <span class="n">tok</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                    <span class="c1"># Try to convert to int or float</span>
                    <span class="n">rhs</span> <span class="o">=</span> <span class="n">try_convert_value</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>

                    <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ll</span><span class="p">:</span>
                        <span class="n">ll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stepset</span><span class="p">[</span><span class="n">lhs</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rhs</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Measurement:&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">read_measures</span><span class="p">:</span>
                    <span class="n">fin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>  <span class="c1"># Jumps to the section that reads measurements</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># then there are no steps,</span>
                <span class="c1"># there are only measures taken in the format parameter: measurement</span>
                <span class="c1"># A few examples of readings</span>
                <span class="c1"># vout_rms: RMS(v(out))=1.41109 FROM 0 TO 0.001  =&gt; Interval</span>
                <span class="c1"># vin_rms: RMS(v(in))=0.70622 FROM 0 TO 0.001  =&gt; Interval</span>
                <span class="c1"># gain: vout_rms/vin_rms=1.99809 =&gt; Parameter</span>
                <span class="c1"># vout1m: v(out)=-0.0186257 at 0.001 =&gt; Point</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">regx</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                    <span class="c1"># Get the data</span>
                    <span class="n">dataname</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">):</span>
                        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataname</span><span class="p">,</span> <span class="n">dataname</span> <span class="o">+</span> <span class="s2">&quot;_FROM&quot;</span><span class="p">,</span> <span class="n">dataname</span> <span class="o">+</span> <span class="s2">&quot;_TO&quot;</span><span class="p">]</span>
                        <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">),</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;to&#39;</span><span class="p">)]</span>
                    <span class="k">elif</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;at&#39;</span><span class="p">):</span>
                        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataname</span><span class="p">,</span> <span class="n">dataname</span> <span class="o">+</span> <span class="s2">&quot;_at&quot;</span><span class="p">]</span>
                        <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;at&#39;</span><span class="p">)]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataname</span><span class="p">]</span>
                        <span class="n">measurements</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)]</span>

                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">headers</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">try_convert_value</span><span class="p">(</span><span class="n">measurements</span><span class="p">[</span><span class="n">k</span><span class="p">])]</span>  <span class="c1"># need to be a list for compatibility</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">enc_norm</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>

        <span class="c1"># message(&quot;Reading Measurements&quot;)</span>
        <span class="n">dataname</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Initializing an empty parameters</span>
        <span class="n">measurements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Measurement: &quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dataname</span><span class="p">:</span>  <span class="c1"># If previous measurement was saved</span>
                    <span class="c1"># store the info</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measurements</span><span class="p">):</span>
                        <span class="n">message</span><span class="p">(</span><span class="s2">&quot;Storing Measurement </span><span class="si">%s</span><span class="s2"> (count </span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dataname</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">measurements</span><span class="p">)))</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">headers</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">]</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">measurements</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">dataname</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">13</span><span class="p">:]</span>  <span class="c1"># text which is after &quot;Measurement: &quot;. len(&quot;Measurement: &quot;) -&gt; 13</span>
                <span class="n">message</span><span class="p">(</span><span class="s2">&quot;Reading Measurement </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">[</span><span class="mi">13</span><span class="p">:])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># This instruction only serves to trigger the exception</span>
                        <span class="n">meas</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># [float(x) for x in tokens[1:]]</span>
                        <span class="n">measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">try_convert_values</span><span class="p">(</span><span class="n">meas</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">measure_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;FROM&quot;</span> <span class="ow">or</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;at&#39;</span><span class="p">):</span>
                            <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataname</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TO&quot;</span><span class="p">:</span>
                            <span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataname</span> <span class="o">+</span> <span class="s2">&quot;_TO&quot;</span>
                        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataname</span><span class="p">]</span> <span class="o">+</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                        <span class="n">measurements</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span><span class="p">(</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

            <span class="n">line</span> <span class="o">=</span> <span class="n">enc_norm</span><span class="p">(</span><span class="n">fin</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>  <span class="c1"># advance to the next line</span>

        <span class="c1"># storing the last data into the dataset</span>
        <span class="n">message</span><span class="p">(</span><span class="s2">&quot;Storing Measurement </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dataname</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">measurements</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">headers</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">]</span>

        <span class="n">message</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> measurements&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">))</span>
        <span class="n">message</span><span class="p">(</span><span class="s2">&quot;Identified </span><span class="si">%d</span><span class="s2"> steps, read </span><span class="si">%d</span><span class="s2"> measurements&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">step_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure_count</span><span class="p">))</span>

        <span class="n">fin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        __getitem__ implements</span>
<span class="sd">        :key: step or measurement name</span>
<span class="sd">        :return: step or measurement set</span>
<span class="sd">        :rtype: List[float]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Slicing in not allowed in this class&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepset</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepset</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>  <span class="c1"># This will raise an Index Error if not found here.</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; is not a valid step variable or measurement name&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="LTSpiceLogReader.steps_with_parameter_equal_to"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceLogReader.steps_with_parameter_equal_to">[docs]</a>    <span class="k">def</span> <span class="nf">steps_with_parameter_equal_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the steps that contain a given condition.</span>

<span class="sd">        :param param: parameter identifier on LTSpice simulation</span>
<span class="sd">        :type param: str</span>
<span class="sd">        :param value:</span>
<span class="sd">        :type value:</span>
<span class="sd">        :return: List of positions that respect the condition of equality with parameter value</span>
<span class="sd">        :rtype: List[int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">condition_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepset</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
        <span class="c1"># tries to convert the value to integer or float, for consistency with data loading implemetation</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">try_convert_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># returns the positions where there is match</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">condition_set</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">v</span><span class="p">]</span></div>

<div class="viewcode-block" id="LTSpiceLogReader.steps_with_conditions"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceLogReader.steps_with_conditions">[docs]</a>    <span class="k">def</span> <span class="nf">steps_with_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">conditions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the steps that respect one more more equality conditions</span>

<span class="sd">        :key conditions: parameters within the LTSpice simulation. Values are the matches to be found.</span>
<span class="sd">        :return: List of steps that repect all the given conditions</span>
<span class="sd">        :rtype: List[int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_set</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">condition_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_with_parameter_equal_to</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_set</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># initialises the list</span>
                <span class="n">current_set</span> <span class="o">=</span> <span class="n">condition_set</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># makes the intersection between the lists</span>
                <span class="n">current_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">current_set</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">condition_set</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">current_set</span></div>

<div class="viewcode-block" id="LTSpiceLogReader.get_step_vars"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceLogReader.get_step_vars">[docs]</a>    <span class="k">def</span> <span class="nf">get_step_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the stepped variable names of .</span>
<span class="sd">        :return: List of step variables.</span>
<span class="sd">        :rtype: list of str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepset</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="LTSpiceLogReader.get_measure_names"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceLogReader.get_measure_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_measure_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the names of the measurements read from the log file.</span>
<span class="sd">        :return: List of measurement names.</span>
<span class="sd">        :rtype: list of str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="LTSpiceLogReader.get_measure_value"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceLogReader.get_measure_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_measure_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measure</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a measure value on a given step.</span>

<span class="sd">        :param measure: name of the measurement to get</span>
<span class="sd">        :type measure: str</span>
<span class="sd">        :param step: optional step number if the simulation has no steps.</span>
<span class="sd">        :type step: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">measure</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;In stepped data, the step number needs to be provided&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="n">step</span><span class="p">]</span></div>

<div class="viewcode-block" id="LTSpiceLogReader.get_measure_values_at_steps"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceLogReader.get_measure_values_at_steps">[docs]</a>    <span class="k">def</span> <span class="nf">get_measure_values_at_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measure</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the measurements taken at a list of steps provided by the steps list.</span>

<span class="sd">        :param measure: name of the measurement to get.</span>
<span class="sd">        :type measure: str</span>
<span class="sd">        :param steps: step number, or list of step numbers.</span>
<span class="sd">        :type steps: int or list</span>
<span class="sd">        :return: measurement or list of measurements</span>
<span class="sd">        :rtype: int or Iterable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">measure</span><span class="p">]</span>  <span class="c1"># Returns everything</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="n">steps</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Assuming it is an iterable</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="n">step</span><span class="p">]</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">]</span></div>

<div class="viewcode-block" id="LTSpiceLogReader.split_complex_values_on_datasets"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceLogReader.split_complex_values_on_datasets">[docs]</a>    <span class="k">def</span> <span class="nf">split_complex_values_on_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal function to split the complex values into additional two columns</span>
<span class="sd">        TODO: Delete the old data and insert new ones the the right position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">param</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">LTComplex</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">param</span><span class="o">+</span><span class="s1">&#39;_mag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">mag</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">param</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">param</span><span class="o">+</span><span class="s1">&#39;_ph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">ph</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">param</span><span class="p">]]</span></div>

<div class="viewcode-block" id="LTSpiceLogReader.export_data"><a class="viewcode-back" href="../../LTSteps.html#PyLTSpice.LTSteps.LTSpiceLogReader.export_data">[docs]</a>    <span class="k">def</span> <span class="nf">export_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">append_with_line_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the measurement information to a tab separated value (.tsv) format. If step data is found, it is</span>
<span class="sd">        included in the exported file.</span>

<span class="sd">        When using export data together with LTSpiceBatch.py classes, it may be helpful to append data to an existing</span>
<span class="sd">        file. For this purpose, the user can user the append_with_line_prefix argument to indicate that an append should</span>
<span class="sd">        be done. And in this case, the user must provide a string that will identify the LTSpice batch run.</span>

<span class="sd">        :param export_file: path to the file containing the information</span>
<span class="sd">        :type export_file: str</span>
<span class="sd">        :param append_with_line_prefix: user information to be written in the file in case an append is to be made.</span>
<span class="sd">        :type append_with_line_prefix: str</span>
<span class="sd">        :return: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># message(tokens)</span>
        <span class="k">if</span> <span class="n">append_with_line_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>  <span class="c1"># rewrites the file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>  <span class="c1"># Appends an existing file</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Empty data set. Exiting without writing file.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">export_file</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">append_with_line_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if an append it will write the filename first</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;user info</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;step</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stepset</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)))</span>
        <span class="n">first_parameter</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">first_parameter</span><span class="p">])):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">step_data</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Empty step</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">step_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stepset</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepset</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="n">meas_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">param</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">append_with_line_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if an append it will write the filename first</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">append_with_line_prefix</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">step_data</span><span class="p">:</span>
                <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">meas_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tok</span><span class="p">:</span>
                        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{</span><span class="n">tok</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">valid_extension</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.log&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.mout&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_extension</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid extension in filename &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This tool only supports the following extensions :&#39;.txt&#39;,&#39;.log&#39;,&#39;.mout&#39;&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">newer_date</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">():</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">date</span> <span class="o">&gt;</span> <span class="n">newer_date</span> <span class="ow">and</span> <span class="n">valid_extension</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">newer_date</span> <span class="o">=</span> <span class="n">date</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">f</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File not found&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This tool only supports the following extensions :&#39;.txt&#39;,&#39;.log&#39;,&#39;.mout&#39;&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">fname_out</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">):</span>
        <span class="n">fname_out</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;txt&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;tsv&#39;</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.log&#39;</span><span class="p">):</span>
        <span class="n">fname_out</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;tlog&#39;</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.mout&#39;</span><span class="p">):</span>
        <span class="n">fname_out</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;mout&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;tmout&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error in file type&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This tool only supports the following extensions :&#39;.txt&#39;,&#39;.log&#39;,&#39;.mout&#39;&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fname_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing File </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating File </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fname_out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;txt&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing Data File&quot;</span><span class="p">)</span>
            <span class="n">reformat_LTSpice_export</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fname_out</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">LTSpiceLogReader</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">split_complex_values_on_datasets</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="n">fname_out</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mout&quot;</span><span class="p">):</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="n">LTSpiceLogReader</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;mout&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">read_measures</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">LTSpiceLogReader</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">step_set</span><span class="o">=</span><span class="n">steps</span><span class="o">.</span><span class="n">stepset</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">stepset</span> <span class="o">=</span> <span class="n">steps</span><span class="o">.</span><span class="n">stepset</span>
            <span class="n">data</span><span class="o">.</span><span class="n">split_complex_values_on_datasets</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="n">fname_out</span><span class="p">)</span>

    <span class="c1"># input(&quot;Press Enter to Continue&quot;)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">PyLTSpice</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../LTSpiceBatch.html">LTSpiceBatch.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SpiceEditor.html">SpiceEditor.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LTSpice_RawRead.html">LTSpice_RawRead.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LTSpice_RawWrite.html">LTSpice_RawWrite.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LTSteps.html">LTSteps.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Histogram.html">Histogram.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SemiOpLogReader.html">LTSpice_SemiDevOpReader.py</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Nuno Brum.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>